<div class="savings-page">

  <div class="page-toolbar">
    <button class="btn-primary" (click)="openCreateModal()">
      <span class="material-symbols-rounded">add</span>
      Nueva Meta
    </button>
  </div>

  <div *ngIf="isLoading()" class="loading-state">
    <div class="spinner"></div>
    <p>Abriendo bóvedas...</p>
  </div>

  <div *ngIf="!isLoading()" class="goals-grid">

    <div *ngFor="let goal of goals()" class="goal-card" (click)="openEditModal(goal)">

      <div class="card-header">
        <div class="header-left">
          <div class="icon-box">
            <span class="material-symbols-rounded">savings</span>
          </div>
          <div class="goal-info">
            <h3>{{ goal.name }}</h3>
            <span class="status">{{ (goal.percentage * 100) | number:'1.0-1' }}% completado</span>
          </div>
        </div>

        <button class="btn-icon-delete" (click)="deleteGoal(goal.id, $event)" title="Eliminar Meta">
          <span class="material-symbols-rounded">delete</span>
        </button>
      </div>

      <div class="money-stats">
        <div class="current">
          <span class="label">Ahorrado</span>
          <span class="val">{{ goal.currentAmount | currency:'PEN':'symbol':'1.0-0' }}</span>
        </div>
        <div class="target">
          <span class="label">Objetivo</span>
          <span class="val">{{ goal.targetAmount | currency:'PEN':'symbol':'1.0-0' }}</span>
        </div>
      </div>

      <div class="progress-track">
        <div class="progress-fill" [style.width.%]="calculateWidth(goal.percentage)"></div>
      </div>

    </div>

    <div *ngIf="goals().length === 0" class="empty-state">
      <span class="material-symbols-rounded icon">sentiment_dissatisfied</span>
      <p>No tienes metas de ahorro activas.</p>
    </div>

  </div>
</div>

<app-modal
  [isOpen]="isModalOpen()"
  [title]="editingId() ? 'Editar Meta' : 'Nueva Meta'"
  (close)="closeModal()">

  <form [formGroup]="goalForm" (ngSubmit)="onSubmit()" class="modal-form">

    <div class="form-group">
      <label>Nombre del Objetivo</label>
      <input type="text" formControlName="name" placeholder="Ej: Viaje a Europa, Laptop" class="form-input">
    </div>

    <div class="form-group">
      <label>Monto Objetivo</label>
      <div class="input-group">
        <span class="prefix">S/</span>
        <input type="number" formControlName="targetAmount" class="form-input">
      </div>
    </div>

    <div class="form-group" *ngIf="!editingId()">
      <label>Aporte Inicial (Opcional)</label>
      <div class="input-group">
        <span class="prefix">S/</span>
        <input type="number" formControlName="initialAmount" class="form-input" placeholder="0.00">
      </div>
      <p class="helper-text">Si ya tienes algo ahorrado para esto, agrégalo aquí.</p>
    </div>

    <div class="form-actions">
      <button type="button" class="btn-cancel" (click)="closeModal()">Cancelar</button>
      <button type="submit" class="btn-primary" [disabled]="goalForm.invalid || isSubmitting()">
        {{ isSubmitting() ? 'Guardando...' : (editingId() ? 'Actualizar' : 'Crear Bóveda') }}
      </button>
    </div>

  </form>
</app-modal>

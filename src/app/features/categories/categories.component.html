<div class="categories-page">

  <header class="page-header">
    <div class="title-group">
      <h1>Categorías</h1>
      <p class="subtitle">Clasifica tus movimientos.</p>
    </div>
    <button class="btn-primary" (click)="openCreateModal()">
      <span class="material-symbols-rounded">add</span>
      Nueva
    </button>
  </header>

  <div *ngIf="isLoading()" class="loading-state">
    <div class="spinner"></div>
  </div>

  <div *ngIf="!isLoading()" class="categories-layout">

    <section class="cat-section">
      <h3 class="section-title text-danger">
        <span class="material-symbols-rounded">trending_down</span> Gastos
      </h3>
      <div class="cat-list">
        <div *ngFor="let cat of expenseCategories()" class="cat-item" (click)="openEditModal(cat)">
          <div class="cat-info">
            <span class="name">{{ cat.name }}</span>
            <span class="badge">{{ cat.managementType === 'DIA_A_DIA' ? 'Diario' : 'Fijo' }}</span>
          </div>
          <button class="btn-icon" (click)="deleteCategory(cat.id, $event)">
            <span class="material-symbols-rounded">delete</span>
          </button>
        </div>
      </div>
    </section>

    <section class="cat-section">
      <h3 class="section-title text-success">
        <span class="material-symbols-rounded">trending_up</span> Ingresos
      </h3>
      <div class="cat-list">
        <div *ngFor="let cat of incomeCategories()" class="cat-item" (click)="openEditModal(cat)">
          <div class="cat-info">
            <span class="name">{{ cat.name }}</span>
            <span class="badge success">{{ cat.managementType === 'DIA_A_DIA' ? 'Variable' : 'Fijo' }}</span>
          </div>
          <button class="btn-icon" (click)="deleteCategory(cat.id, $event)">
            <span class="material-symbols-rounded">delete</span>
          </button>
        </div>
      </div>
    </section>

  </div>
</div>

<app-modal [isOpen]="isModalOpen()" [title]="editingId() ? 'Editar Categoría' : 'Nueva Categoría'" (close)="closeModal()">
  <form [formGroup]="categoryForm" (ngSubmit)="onSubmit()" class="modal-form">

    <div class="form-group">
      <label>Nombre</label>
      <input type="text" formControlName="name" class="form-input" placeholder="Ej: Supermercado">
    </div>

    <div class="form-group">
      <label>Tipo de Transacción</label>
      <div class="radio-group">
        <label *ngFor="let type of eTypes" [class.active]="categoryForm.get('type')?.value === type">
          <input type="radio" formControlName="type" [value]="type">
          {{ type }}
        </label>
      </div>
    </div>

    <div class="form-group">
      <label>Tipo de Gestión</label>
      <select formControlName="managementType" class="form-select">
        <option *ngFor="let mgmt of eManagement" [value]="mgmt">
          {{ mgmt === 'DIA_A_DIA' ? 'Día a Día (Variable)' : 'Planificado (Fijo)' }}
        </option>
      </select>
      <p class="helper-text">
        <strong>Día a Día:</strong> Gastos hormiga, comida, transporte.<br>
        <strong>Planificado:</strong> Alquiler, servicios, suscripciones.
      </p>
    </div>

    <div class="form-actions">
      <button type="button" class="btn-cancel" (click)="closeModal()">Cancelar</button>
      <button type="submit" class="btn-primary" [disabled]="categoryForm.invalid || isSubmitting()">
        {{ isSubmitting() ? 'Guardando...' : 'Guardar' }}
      </button>
    </div>
  </form>
</app-modal>
